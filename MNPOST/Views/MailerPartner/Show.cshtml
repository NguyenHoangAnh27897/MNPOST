
@{
    ViewBag.Title = "Show";
}


<div ng-app="myApp" class="row" ng-controller="myCtrl">


    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>QUẢN LÝ ĐƠN GỬI ĐỐI TÁC - {{postHandle}}</h2>
                <div class="nav navbar-right">
                    <button type="button" class="btn btn-primary" ng-click="addMailerPartner()" >Tạo bảng kê</button>
                    <button type="button" class="btn btn-success" ng-show="document.StatusID === 0" ng-click="updateDetails()">Cập nhật</button>
                    <button type="button" class="btn btn-error" ng-show="document.StatusID === 0">Xác nhận gửi đối tác</button>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <div class="" role="tabpanel" data-example-id="togglable-tabs">
                    <ul class="nav nav-tabs bar_tabs" role="tablist">
                        <li role="presentation" class="active">
                            <a href="#tab_document" role="tab" data-toggle="tab" aria-expanded="false" ng-click="showEdit=false; showDeliveries = true;showUpdate = false">Sổ phát</a>
                        </li>
                        <li role="presentation">
                            <a href="#tab_detail" role="tab" data-toggle="tab" aria-expanded="false" ng-click="showEdit=true ; showDeliveries = false; showUpdate = false">Chi tiết</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active in" id="tab_document" aria-labelledby="home-tab">
                            <!-- begin tab-->
                            <div class="row">
                                <form name="formSearch" ng-submit="GetData()">
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            <label>Thời gian</label>
                                            <div class="row">
                                                <div class="col-sm-5">
                                                    <input type="text" my-tool-tip="Từ ngày" required class="form-control" ui-mask="99/99/9999"  ui-mask-placeholder ui-mask-placeholder-char="" ng-model="searchInfo.fromDate" >
                                                </div>
                                                <div class="col-sm-5">
                                                    <input type="text" my-tool-tip="Đến ngày" required class="form-control" ui-mask="99/99/9999"  ui-mask-placeholder ui-mask-placeholder-char="" ng-model="searchInfo.toDate">
                                                </div>
                                                <div class="col-sm-2">
                                                    <button class="btn btn-primary" type="submit">Xem thông tin</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>

                                <!-- thong tin-->
                                <div class="col-md-12">
                                    <!-- table data-->
                                    <div class="table-responsive">
                                        <table class="table table-striped jambo_table bulk_action">
                                            <thead>
                                                <tr class="headings">
                                                    <th>STT</th>
                                                    <th>Mã bảng kê</th>
                                                    <th>Ngày lập</th>
                                                    <th>Giờ lập</th>
                                                    <th>Đơn vị</th>
                                                    <th>Tình trạng</th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                <tr ng-repeat="item in mailerPartners" ng-class="{'active': item.StatusID == 0, 'success' : item.StatusID == 1}">
                                                    <td>
                                                        {{$index + 1}}&nbsp;&nbsp;
                                                        <a href="#" ng-click="showDetail($index)"><i my-tool-tip="Chỉnh sửa" class="fa fa-pencil-square"></i></a>
                                                    </td>
                                                    <td>{{item.DocumentCode}}</td>
                                                    <td><span class="label label-danger">{{item.AcceptDate}}</span></td>
                                                    <td><span class="label label-warning">{{item.AcceptTime}}</span></td>
                                                    <td>{{item.ParterName}}</td>
                                                    <td><span class="label label-primary">{{mailerPartnerStatus[item.StatusID].name}}</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--phan trang-->
                                    <ul items-per-page="itemPerPage" uib-pagination total-items="totalItems" ng-model="currentPage" ng-change="pageChanged()" max-size="maxSize" boundary-link-numbers="true" rotate="false" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></ul>
                                    <!-- end phan trang-->

                                </div>

                            </div>
                            <!-- end tab-->
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="tab_detail" aria-labelledby="profile-tab">
                            <div class="row">
                                <div class="col-sm-6">
                                   <div class="form-group">
                                       <label>Đơn vị</label>
                                       <input disabled type="text" class="form-control" value="{{document.ParterName}}"/>
                                   </div>
                                    <div class="form-group">
                                        <label>Ghi chú</label>
                                        <textarea disabled class="form-control">{{document.AcceptDate}}</textarea>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>Ngày tạo</label>
                                        <input disabled type="text" class="form-control" value="{{document.AcceptDate}}" />
                                    </div>
                                    <div class="form-group">
                                        <label>Giờ tạo</label>
                                        <input disabled type="text" class="form-control" value="{{document.AcceptTime}}" />
                                    </div>
                                </div>


                                <div class="col-sm-12">
                                    <hr />
                                    <form ng-submit="addMailer(addmailerdelivery.$valid)" name="addmailerdelivery" ng-show="document.StatusID === 0">
                                        <div class="row">
                                            <div class="col-sm-4">
                                                <input type="text" class="form-control" ng-model="mailerId" required />
                                            </div>
                                            <div class="col-sm-2">
                                                <button class="btn btn-primary" type="submit">Thêm</button>
                                            </div>
                                            <div class="col-sm-2">
                                                <button class="btn btn-success" >Thêm từ danh sách</button>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="table-responsive">
                                        <table class="table table-striped jambo_table bulk_action scrollmenu">
                                            <thead>
                                                <tr class="headings">
                                                    <th>STT</th>
                                                    <th>Vận đơn</th>
                                                    <th>Vận đơn đối tác</th>
                                                    <th>Giá qua đối tác</th>
                                                    <th>Trạng thái</th>
                                                    <th>Khối lượng</th>
                                                    <th>Dịch vụ</th>
                                                    <th>Ng gửi</th>
                                                    <th>Nơi gửi</th>
                                                    <th>Ng nhận</th>
                                                    <th>Nơi đến</th>
                                                    <th>Thụ hộ</th>
                                                    <th>Ghi chú</th>
                                                    <th>Trạng thái</th>
                                                    <th>#</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="item in mailers" ng-class="{'active': item.StatusID === 0, 'success' : item.StatusID === 1, 'error' : item.StatusID === 2}">
                                                    <td>{{$index + 1}}</td>
                                                    <td>{{item.MailerID}}</td>
                                                    <td><input type="text" ng-model="item.OrderReference" class="tableinput"/></td>
                                                    <td><input type="number" ng-model="item.OrderCosst" class="tableinput" /></td>
                                                    <td>{{mailerStatus[item.StatusID].name}}</td>
                                                    <td>{{item.Weight}}</td>
                                                    <td>{{item.MailerTypeID}}</td>
                                                    <td>{{item.SenderName}}</td>
                                                    <td>{{item.SenderAddress}}</td>
                                                    <td>{{item.RecieverName}}</td>
                                                    <td>{{item.RecieverAddress}}</td>
                                                    <td>{{item.COD}}</td>
                                                    <td>{{item.Notes}}</td>
                                                    <td>{{mailerPartnerStatus[item.StatusID].name}}</td>
                                                    <td><a href="#" ng-click="deleteDetail($index)" ng-show="item.StatusID === 0">Xóa</a> 
                                                    <a href="#" ng-click="deleteDetail($index)" ng-show="item.StatusID === 1">Hủy</a></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- choose buu cuc-->
    <div id="choosePostOfficeModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-body">
                    <div class="form-group">
                        <label>Chọn bưu cục xử lý</label>
                        <select class="form-control" ng-model="postHandle">
                            <option ng-repeat="item in postOffices" value="{{item}}">{{item}}</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" ng-click="choosePostHandle()">Chọn</button>
                </div>
            </div>

        </div>
    </div>
    <!-- end chon buu cuc-->

    <!-- tao bang ke-->
    <div id="createPartnerMailer" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <form name="createMailerPartnerForm" ng-submit="finishMailerPartnerSend(createMailerPartnerForm.$valid)">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Chọn đối tác</label>
                                    <select class="form-control" ng-model="mailerPartnerSend.partnerId">
                                        <option ng-repeat="item in partners" value="{{item.code}}">{{item.name}}</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ghi chú</label>
                                    <textarea rows="3" required class="form-control" ng-model="mailerPartnerSend.notes"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default">Hoàn thành</button>
                    </div>
                </form>
            </div>

        </div>
    </div>

    <!-- end tao bang ke-->


</div>

@section styles {

   <style type="text/css">
    .scrollmenu {
        overflow: auto;
        white-space: nowrap;
    }

    .tableinput {
        width: 150px;
        height: 25px;
    }


</style>

}

<!-- end content-->
@section scripts {

    <script>

        var postOfficeDatas = angular.fromJson(@Html.Raw(Json.Encode(ViewBag.PostOffices)));
        var fromDate = '@Html.Raw(ViewBag.FromDate)';
        var toDate = '@Html.Raw(ViewBag.ToDate)';
        var partnerDatas = angular.fromJson(@Html.Raw(Json.Encode(ViewBag.Partners)));
        console.log(fromDate);
    </script>
    <script src="~/Scripts/order/mailerpartner.js"></script>
}

